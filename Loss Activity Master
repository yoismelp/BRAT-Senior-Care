Sub Button1_Click()
    Application.Calculation = xlCalculationManual
    
    Dim CURRENT_USER As String
        CURRENT_USER = Application.UserName
    Dim TimeStamp As String
        TimeStamp = Format(Now(), "yyyyMMddhhmmss")
    Dim ENTRY_DATE As String
        ENTRY_DATE = Format(Now, "YYYYMMDD hh:mm:ss  AM/PM")
    Dim filePat As String
        filePath = Application.ActiveWorkbook.FullName
    Sheets("Loss Listing").Select
    
    'LossListingTable
    'LossListingTableHandler
    
    'ExposureTable
    'ExposureTableExportHandler ENTRY_DATE, CURRENT_USER, "ExposureTable", TimeStamp
    
    'AccountInfoTable
    'AccountInfoTableExportHandler ENTRY_DATE, CURRENT_USER, "AccountInfo", TimeStamp
           
    'TowerTable
    'DataExportHandler ENTRY_DATE, CURRENT_USER, "TowerTable", TimeStamp
    
    'LocationTable
    DataExportHandler ENTRY_DATE, CURRENT_USER, "LocationTable", TimeStamp
    
    Application.Calculation = xlCalculationAutomatic
End Sub

Sub AccountInfoTableExportHandler(EntryDate, EntryUser, TableName, TimeStamp)
    Sheets("Export Data").Visible = True
    Sheets("Export Data").Select
    Range(TableName).Select
    'START Add EntryDate and EntryBy
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    ActiveCell.EntireColumn.Select
    ActiveCell.Activate

    Selection.Insert Shift:=xlToRight
    Selection.Insert Shift:=xlToRight
    Selection.Insert Shift:=xlToRight
    
    Range(TableName).Select
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "EntryBy"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "EntryDate"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "VariableValueExport"
    
    'Values
    ActiveCell.Offset(1, -2).Select
    ActiveCell.FormulaR1C1 = EntryUser
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    
    ActiveCell.Offset(0, 1).Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = EntryDate
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    Selection.NumberFormat = "YYYYMMDD hh:mm:ss AM/PM"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=IF(CELL(""format"", [@[Variable Value]])=""D4"", TEXT([@[Variable Value]], ""yyyy-MM-dd""), [@[Variable Value]])"
    
    'END Add EntryDate and EntryBy
    
    'START Save file
    Range(TableName & "[#All]").Select
    Selection.Copy
    Workbooks.Add
    
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Application.CutCopyMode = False
    ActiveSheet.ListObjects.Add(xlSrcRange, Selection.CurrentRegion, , xlYes).Name = _
        "Table1"

    Application.DisplayAlerts = False
    
    ActiveWorkbook.SaveAs Filename:= _
        "https://bowheadsi.sharepoint.com/sites/DevDataVault/Shared%20Documents/Policy%20Processing/BRAT%20-%20Losses%20Export/" + TimeStamp + "_BRAT" + TableName + EntryUser + ".xlsx" _
        , FileFormat:=51
    
    ActiveWindow.Close
    
    'Remove EntryBy
    Range(TableName & "[[#Headers],['EntryBy]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove EntryTime
    Range(TableName & "[[#Headers],['EntryDate]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove VariableValueExport
    Range(TableName & "[[#Headers],['VariableValueExport]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Hide Tab
    Sheets("Export Data").Visible = False
    
    'END Save file
    Sheets("Loss Listing").Select
    Application.DisplayAlerts = True
End Sub

Sub ExposureTableExportHandler(EntryDate, EntryUser, TableName, TimeStamp)
    Sheets("Export Data").Visible = True
    Sheets("Export Data").Select
    Range(TableName).Select
    'START Add EntryDate and EntryBy
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    ActiveCell.EntireColumn.Select
    ActiveCell.Activate

    Selection.Insert Shift:=xlToRight
    Selection.Insert Shift:=xlToRight
    Selection.Insert Shift:=xlToRight
    
    Range(TableName).Select
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "EntryBy"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "EntryDate"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "StartDateExport"
    
    'Values
    ActiveCell.Offset(1, -2).Select
    ActiveCell.FormulaR1C1 = EntryUser
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    
    ActiveCell.Offset(0, 1).Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = EntryDate
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    Selection.NumberFormat = "YYYYMMDD hh:mm:ss AM/PM"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Start Date]], ""yyyyMMdd"")"
    
    'END Add EntryDate and EntryBy
    
    'START Save file
    Range(TableName & "[#All]").Select
    Selection.Copy
    Workbooks.Add
    
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Application.CutCopyMode = False
    ActiveSheet.ListObjects.Add(xlSrcRange, Selection.CurrentRegion, , xlYes).Name = _
        "Table1"

    Application.DisplayAlerts = False
    
    ActiveWorkbook.SaveAs Filename:= _
        "https://bowheadsi.sharepoint.com/sites/DevDataVault/Shared%20Documents/Policy%20Processing/BRAT%20-%20Losses%20Export/" + TimeStamp + "_BRAT" + TableName + EntryUser + ".xlsx" _
        , FileFormat:=51
    
    ActiveWindow.Close
    
    'Remove EntryBy
    Range(TableName & "[[#Headers],['EntryBy]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove EntryTime
    Range(TableName & "[[#Headers],['EntryDate]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Start Date Export
    Range(TableName & "[[#Headers],['StartDateExport]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Hide Tab
    Sheets("Export Data").Visible = False
    
    'END Save file
    Sheets("Loss Listing").Select
    Application.DisplayAlerts = True
End Sub

Sub DataExportHandler(EntryDate, EntryUser, TableName, TimeStamp)
    Sheets("Export Data").Visible = True
    Sheets("Export Data").Select
    Range(TableName).Select
    'START Add EntryDate and EntryBy
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    ActiveCell.EntireColumn.Select
    ActiveCell.Activate

    Selection.Insert Shift:=xlToRight
    Selection.Insert Shift:=xlToRight
    
    Range(TableName).Select
    Selection.End(xlToRight).Offset(-1, 1).Select
    
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "EntryBy"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "EntryDate"
    
    'Values
    ActiveCell.Offset(1, -1).Select
    ActiveCell.FormulaR1C1 = EntryUser
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    
    ActiveCell.Offset(0, 1).Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = EntryDate
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    Selection.NumberFormat = "YYYYMMDD hh:mm:ss AM/PM"
    
    'END Add EntryDate and EntryBy
    
    'START Save file
    Range(TableName & "[#All]").Select
    Selection.Copy
    Workbooks.Add
    
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Application.CutCopyMode = False
    ActiveSheet.ListObjects.Add(xlSrcRange, Selection.CurrentRegion, , xlYes).Name = _
        "Table1"

    Application.DisplayAlerts = False
    
    ActiveWorkbook.SaveAs Filename:= _
        "https://bowheadsi.sharepoint.com/sites/DevDataVault/Shared%20Documents/Policy%20Processing/BRAT%20-%20Losses%20Export/" + TimeStamp + "_BRAT" + TableName + EntryUser + ".xlsx" _
        , FileFormat:=51
    
    ActiveWindow.Close
    
    'Remove EntryBy
    Range(TableName & "[[#Headers],['EntryBy]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove EntryTime
    Range(TableName & "[[#Headers],['EntryDate]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Hide Tab
    Sheets("Export Data").Visible = False
    
    'END Save file
    Sheets("Loss Listing").Select
    Application.DisplayAlerts = True
End Sub

Sub LossListingTableHandler()
    
    Application.Calculation = xlCalculationManual
    Range("C:M").EntireColumn.Hidden = False
    
    
    Dim CURRENT_USER As String
        CURRENT_USER = Application.UserName
    Dim TimeStamp As String
        TimeStamp = Format(Now(), "yyyyMMddhhmmss")
    Dim filePat As String
        filePath = Application.ActiveWorkbook.FullName
    Sheets("Loss Listing").Select
    
    'START Add row count
    Range("LossTable[[#Headers],['#]]").Select
    ActiveCell.Offset(1, 0).Select
    Selection.ListObject.ListRows.Add (1)
    ActiveCell.FormulaR1C1 = "0"
    Range("LossTable[[#Headers],['Coverage]]").Select
    ActiveCell.Offset(1, 0).Select
    ActiveCell.FormulaR1C1 = "PL"
    ActiveCell.Offset(0, 1).Select
    
    'To get number of rows populated using Coverage column as reference
    Dim myColumn As ListColumn
    Set myColumn = Sheets("Loss Listing").ListObjects("LossTable").ListColumns("Coverage")
    Dim UsedRows As Long
    UsedRows = Application.CountA(myColumn.DataBodyRange)
    ActiveCell.FormulaR1C1 = UsedRows - 1
    'END row count
    
    'START Filter out blank rows based on Coverage
    ActiveSheet.ListObjects("LossTable").Range.AutoFilter Field:=14, Criteria1 _
        :="<>"
    'END Filter out blank rows based on Coverage
    Range("LossTable[[#Headers],['#]]").Select
    ActiveCell.FormulaR1C1 = "BRATRowNumber"
    
    'START Fromat dates
    'Range("LossTable[[#All],[Evaluation Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Report Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Loss or Accident Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Closed Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Experience Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'END Fromat dates
    
    
    'START Adding new columns
    
    'Headers
    Selection.End(xlToRight).Offset(0, 1).Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = "Evaluation Date Import"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "Report Date Import"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "Loss or Accident Date Import"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "Closed Date Import"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "Experience Date Import"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "EntryBy"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "EntryDate"
    
    'Values
    ActiveCell.Offset(1, -6).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Evaluation Date]], ""yyyyMMdd"")"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Report Date]], ""yyyyMMdd"")"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Loss or Accident Date Import]], ""yyyyMMdd"")"
     
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Closed Date Import]], ""yyyyMMdd"")"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = "=TEXT([@[Experience Date Import]], ""yyyyMMdd"")"
    
    ActiveCell.Offset(0, 1).Select
    ActiveCell.FormulaR1C1 = Application.UserName
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    
    ActiveCell.Offset(0, 1).Select
    Application.CutCopyMode = False
    ActiveCell.FormulaR1C1 = Format(Now, "YYYYMMDD hh:mm:ss  AM/PM")
    ActiveCell.Select
    Selection.Copy
    Range(Selection, Selection.End(xlDown)).Select
    ActiveSheet.Paste
    Selection.NumberFormat = "YYYYMMDD hh:mm:ss AM/PM"
    'END Adding new columns
    
    Range("LossTable[#All]").Select
    
    Selection.Copy
    Workbooks.Add
    'ActiveSheet.Paste
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Application.CutCopyMode = False
    ActiveSheet.ListObjects.Add(xlSrcRange, Selection.CurrentRegion, , xlYes).Name = _
        "LossTable"
        
    Application.DisplayAlerts = False
    ActiveWorkbook.SaveAs Filename:= _
        "https://bowheadsi.sharepoint.com/sites/DevDataVault/Shared%20Documents/Policy%20Processing/BRAT%20-%20Losses%20Export/" + TimeStamp + "_BRATForLosses_" + CURRENT_USER + ".xlsx" _
        , FileFormat:=51
    
    ActiveWindow.Close
    
    'Remove EntryBy
    Range("LossTable[[#Headers],['EntryDate]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove EntryTime
    Range("LossTable[[#Headers],['EntryBy]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Evaluation Date Import
    Range("LossTable[[#Headers],['Evaluation Date Import]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Report Date Import
    Range("LossTable[[#Headers],['Report Date Import]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Loss or Accident Date Import
    Range("LossTable[[#Headers],['Loss or Accident Date Import]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Closed Date Import
    Range("LossTable[[#Headers],['Closed Date Import]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    'Remove Experience Date Import
    Range("LossTable[[#Headers],['Experience Date Import]]").Select
    ActiveCell.EntireColumn.Select
    Selection.Delete Shift:=xlToLeft
    
    Range("LossTable[[#Headers],['BRATRowNumber]]").Select
    ActiveCell.FormulaR1C1 = "#"
    
    'START Fromat dates back
    'Range("LossTable[[#All],[Evaluation Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Report Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Loss or Accident Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Closed Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'Range("LossTable[[#All],[Experience Date]]").Select
    'Selection.NumberFormat = "m/d/yyyy"
    'END Fromat dates back
    
    'DELETE ROW COUNT
    ActiveSheet.ListObjects("LossTable").Range.AutoFilter Field:=14
    ActiveCell.Offset(1, 0).Select
    Selection.ListObject.ListRows(1).Delete
    
    
    Application.DisplayAlerts = True
    Range("C:M").EntireColumn.Hidden = True
    
End Sub
